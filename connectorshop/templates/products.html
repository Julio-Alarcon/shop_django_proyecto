{% extends 'base.html' %} {% block content %}
<!-- Contenido -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
<div class="container-product container-fluid background-product min-height-600">
	<div class="card background-blue-black mx-2 position-fixed" style="left: 0; z-index: 9999; opacity: 0.8">
		<div class="card-body">
			<form>
				{{ form_article.search.label_tag }}
				<br />
				{{ form_article.search }}
				<br />
				{{ form_article.tag.label_tag }}
				<br />
				{{ form_article.tag }}
				<br />
				{{ form_article.category.label_tag }}
				<br />
				{{ form_article.category }}
				<br />
				<button class="btn btn-primary mt-4" type="submit">Buscar</button>
			</form>
		</div>
	</div>
	<div class="row" style="margin-left: 280px">
		{% for article in articles %} {% if article.published %}
		<div class="mb-4 mt-4" style="width: 320px">
			<div class="card h-100 w-100 background-black" style="min-width: 300px; max-width: 300px; min-height: 600px; max-height: 600px">
				<img class="card-img-top h-50" src="/media/{{ article.image }}" alt="" onclick="showReviews('{{ article.id }}')" />
				<div class="card-body">
					<h4 class="card-title">
						<a href="#">{{ article.title }}</a>
					</h4>
					{% load humanize %}
					<h5>${{ article.price|floatformat:0|intcomma }} CLP</h5>
					<p class="card-text text-orange">{{ article.description }}</p>
				</div>
				<div class="card-footer footer-product">
					{% if article.stock > 0 %}
					<div class="row d-flex justify-content-center">
						<select class="item-quantity input-number my-2" name="x" id="{{ article.id }}">
							{% for i in ""|rjust:article.stock %}
							<option value="{{ forloop.counter }}">{{ forloop.counter }}</option>
							{% endfor %}
						</select>
					</div>
					<div class="row d-flex justify-content-center">
						<button class="btn btn-primary btn-item cyberpunk-button">Agregar</button>
					</div>
					{% else %}
					<div class="row d-flex justify-content-center">
						<button disabled class="btn-item cyberpunk-button">OUT STOCK</button>
					</div>
					{% endif %}
				</div>
			</div>
		</div>
		<div id="reviews-{{ article.id }}" class="mt-3" style="display: none">
			<img class="card-img-top h-50" src="/media/{{ article.image }}" alt=""/>
			{% for review in article.reviews.all %}
			<div class="card mb-2">
				<div class="card-body p-2">
					{% if review.rating > 0 %}
					<div class="card-text">
						{% if review.rating >= 1 %}
						<i class="bi bi-star-fill"></i>
						{% else %}
						<i class="bi bi-star"></i>
						{% endif %} {% if review.rating >= 2 %}
						<i class="bi bi-star-fill"></i>
						{% else %}
						<i class="bi bi-star"></i>
						{% endif %} {% if review.rating >= 3 %}
						<i class="bi bi-star-fill"></i>
						{% else %}
						<i class="bi bi-star"></i>
						{% endif %} {% if review.rating >= 4 %}
						<i class="bi bi-star-fill"></i>
						{% else %}
						<i class="bi bi-star"></i>
						{% endif %} {% if review.rating >= 5 %}
						<i class="bi bi-star-fill"></i>
						{% else %}
						<i class="bi bi-star"></i>
						{% endif %}
					</div>
					{% endif %}
					<div class="d-flex justify-content-between align-items-center">
						<h5 class="card-title">{{ review.author }}</h5>
						<div class="d-flex align-items-center">
							<span class="text-muted me-2">{{ review.created_at|date:'d/m/Y' }}</span>
						</div>
					</div>
					<p class="card-text">{{ review.comment }}</p>
				</div>
			</div>
			{% endfor %}
		</div>
		{% endif %} {% empty %}
		<p class="text-orange">No hay artículos disponibles.</p>
		{% endfor %}
	</div>
	{% if articles %}
	<div class="d-flex justify-content-center">
		<nav aria-label="Page navigation example">
			<ul class="pagination">
				<!--Que haces aquí
⠀ ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣀⣀⣀⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣾⠋⠉⠉⠉⠙⠛⠻⢶⣤⡀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⡾⠁⠀⠀⠀⠀⠀⠀⠀⠀⠈⢻⡆⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣀⣠⣴⠟⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⡟⠁⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣴⠶⠟⠛⠉⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⡟⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣠⣴⠾⠛⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣾⠁⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⡶⠛⠛⠋⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⠟⠁⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⡟⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣾⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⠞⠋⠀⠀⠀⠀⣠⣴⠶⠶⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⡿⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⣄⣀⣀⣤⡴⠟⠋⠀⠀⠀⠘⣷⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⠟⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣟⠉⠙⢷⣄⠀⠀⠀⠀⠀⠀⠘⣷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⠏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⣷⡀⠀⠹⣧⡀⠀⠀⠀⠀⠀⣼⠃⠀⠀⠀⠀⠀⠀⠀⢀⣾⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣷⡀⠀⠈⠛⣷⣤⣴⠶⠟⠃⠀⠀⠀⠀⠀⠀⠀⢀⣾⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣷⡀⠀⠀⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣾⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⢷⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠻⠟⠛⣻⡿⠀⠀⠀⠀⠀⢀⣤⡾⠛⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⡾⠋⠀⠀⠀⠀⢀⣴⠟⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⠟⠀⠀⠀⠀⣠⣾⡿⠁⢀⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⠏⠀⠀⠀⢀⡾⢫⣿⠁⠀⣼⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡾⠃⠀⠀⢀⣴⠟⢡⡟⣿⠀⠀⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⠟⠁⠀⠀⣰⠟⠁⢠⡿⠀⢿⡄⢰⡟⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⠏⠀⠀⢠⣾⠋⠀⢀⡿⠁⠀⠈⠛⠿⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡏⠀⠀⣴⢿⡟⠀⠀⣾⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⢷⣄⣾⠋⠘⣧⡀⢰⡟⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠁⠀⠀⠈⠛⠋⠀⠀⠀⠀⠀⠀⠀
-->
				{% if articles.has_previous %}
				<li class="page-item">
					<a class="page-link" href="?page={{ articles.previous_page_number }}">&laquo;</a>
				</li>
				{% else %}
				<li class="page-item disabled">
					<a class="page-link" href="#">&laquo;</a>
				</li>
				{% endif %} {% for page in articles.paginator.page_range %} {% if articles.number == page %}
				<li class="page-item active">
					<a class="page-link" href="#">{{ page }}</a>
				</li>
				{% elif page > articles.number|add:'-3' and page < articles.number|add:'3' %}
				<li class="page-item">
					<a class="page-link" href="?page={{ page }}">{{ page }}</a>
				</li>
				{% endif %} {% endfor %} {% if articles.has_next %}
				<li class="page-item">
					<a class="page-link" href="?page={{ articles.next_page_number }}">&raquo;</a>
				</li>
				{% else %}
				<li class="page-item disabled">
					<a class="page-link" href="#">&raquo;</a>
				</li>
				{% endif %}
			</ul>
		</nav>
	</div>
	{% endif %}
</div>
<!--Lista de cantidad de objetos-->
<div class="modal fade" id="reviews-modal" tabindex="-1" aria-labelledby="reviews-modal-label" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="reviews-modal-label">Reviews</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">X</button>
			</div>
			<div class="modal-body" id="reviews-modal-body"></div>
		</div>
	</div>
</div>
<!--Lista de cantidad de objetos-->
<script>
	const itemQuantityInputs = document.querySelectorAll(".item-quantity");
	itemQuantityInputs.forEach((input) => {
		input.addEventListener("change", (event) => {
			const input = event.target;
			const addButton = input.parentElement.parentElement;
			addButton.querySelector(".btn-text").textContent = `Agregar (${input.value})`;
		});
	});
</script>
<!--Lista de opiniones-->
<script>
	function showReviews(articleId) {
		var modalBody = document.getElementById("reviews-" + articleId).innerHTML;
		var modal = new bootstrap.Modal(document.getElementById("reviews-modal"));
		document.getElementById("reviews-modal-body").innerHTML = modalBody;
		document.getElementById("reviews-modal-body").classList.add("show", "collapse");
		document.getElementById("reviews-modal-body").classList.remove("hide");
		modal.show();
	}
	function hideReviews() {
		document.getElementById("reviews-modal-body").classList.add("hide");
		document.getElementById("reviews-modal-body").classList.remove("show", "collapse");
	}
</script>
{% endblock %}
